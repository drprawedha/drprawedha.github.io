<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calendar History Pekerjaan</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #calendar { max-width: 900px; margin: 20px auto; }
    #searchBox { max-width: 600px; margin: 0 auto; display: flex; gap: 10px; }
    #searchInput { flex: 1; padding: 8px; font-size: 1rem; }
    #searchResult { max-width: 600px; margin: 20px auto; }

    .modal {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      z-index: 9999;
      display: none;
    }

    .modal h3 { margin-top: 0; }

    .close {
      position: absolute;
      top: 5px;
      right: 10px;
      font-size: 18px;
      cursor: pointer;
      color: #999;
    }

    .close:hover { color: red; }

    .fc-event {
      background-color: #2196F3;
      border: none;
      font-size: 0.75em;
      padding: 2px;
    }

    ul { padding-left: 20px; }
  </style>
</head>
<body>

<h2 style="text-align:center;">üìÖ Kalender History Pekerjaan</h2>

<!-- Search Menu -->
<div id="searchBox">
  <input type="text" id="searchInput" placeholder="Cari pekerjaan (contoh: 'firmware' atau 'meeting')">
  <button onclick="searchData()">üîç Cari</button>
</div>

<!-- Calendar -->
<div id="calendar"></div>

<!-- Search Result -->
<div id="searchResult"></div>

<!-- Modal -->
<div id="historyModal" class="modal">
  <span class="close" onclick="closeModal()">&times;</span>
  <h3>History Pekerjaan</h3>
  <div id="historyContent"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script>
  let pekerjaanData = {
    "2025-08-01": ["Menyelesaikan laporan mingguan", "Meeting dengan vendor CCTV"],
    "2025-08-02": ["Instalasi jaringan di lantai 3", "Backup server hotel"],
    "2025-08-03": ["Desain poster Wedding Expo", "Update firmware STB"]
  };

  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');
    const modal = document.getElementById('historyModal');

    const pekerjaanEvents = Object.keys(pekerjaanData).map(date => ({
      title: `üìå ${pekerjaanData[date].length} tugas`,
      start: date,
      allDay: true
    }));

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: ''
      },
      events: pekerjaanEvents,
      dateClick: function (info) {
        const date = info.dateStr;
        const history = pekerjaanData[date] || ['Tidak ada pekerjaan tercatat'];
        showModal(history, date);
      }
    });

    calendar.render();

    // Klik di luar modal menutup popup
    document.addEventListener('click', function (event) {
      const isClickInside = modal.contains(event.target);
      if (!isClickInside && modal.style.display === 'block') {
        closeModal();
      }
    });
  });

  function showModal(historyList, date) {
    const modal = document.getElementById('historyModal');
    const content = document.getElementById('historyContent');
    content.innerHTML = `<strong>${date}</strong><ul>` + historyList.map(item => `<li>${item}</li>`).join('') + '</ul>';
    modal.style.display = 'block';
  }

  function closeModal() {
    document.getElementById('historyModal').style.display = 'none';
  }

  function searchData() {
    const keyword = document.getElementById('searchInput').value.toLowerCase();
    const resultDiv = document.getElementById('searchResult');
    resultDiv.innerHTML = '';

    if (!keyword) {
      resultDiv.innerHTML = '<p>Silakan masukkan kata kunci untuk mencari.</p>';
      return;
    }

    let resultHTML = '';
    let found = false;

    for (const [date, tasks] of Object.entries(pekerjaanData)) {
      const filteredTasks = tasks.filter(task => task.toLowerCase().includes(keyword));
      if (filteredTasks.length > 0) {
        found = true;
        resultHTML += `<h4>${date}</h4><ul>${filteredTasks.map(task => `<li>${task}</li>`).join('')}</ul>`;
      }
    }

    resultDiv.innerHTML = found ? resultHTML : '<p>Tidak ditemukan pekerjaan yang sesuai.</p>';
  }
</script>

</body>
</html>
