<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calendar History Pekerjaan</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #calendar { max-width: 900px; margin: auto; }

    .modal {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      z-index: 9999;
      display: none;
    }

    .modal h3 { margin-top: 0; }

    .close {
      position: absolute;
      top: 5px;
      right: 10px;
      font-size: 18px;
      cursor: pointer;
      color: #999;
    }

    .close:hover { color: red; }

    .fc-event {
      background-color: #2196F3;
      border: none;
      font-size: 0.75em;
      padding: 2px;
    }
  </style>
</head>
<body>

<h2>ðŸ“… Kalender History Pekerjaan</h2>
<div id="calendar"></div>

<!-- Modal -->
<div id="historyModal" class="modal">
  <span class="close" onclick="closeModal()">&times;</span>
  <h3>History Pekerjaan</h3>
  <div id="historyContent"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script>
  let pekerjaanData = {};

  function loadPekerjaanData() {
    return fetch('pekerjaan.json')
      .then(response => response.json())
      .then(data => {
        pekerjaanData = data;

        // Convert to FullCalendar events
        const pekerjaanEvents = Object.keys(data).map(date => ({
          title: `ðŸ“Œ ${data[date].length} tugas`,
          start: date,
          allDay: true
        }));

        initCalendar(pekerjaanEvents);
      })
      .catch(error => console.error('Gagal memuat data:', error));
  }

  function initCalendar(pekerjaanEvents) {
    const calendarEl = document.getElementById('calendar');
    const modal = document.getElementById('historyModal');

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: ''
      },
      events: pekerjaanEvents,
      dateClick: function (info) {
        const date = info.dateStr;
        const history = pekerjaanData[date] || ['Tidak ada pekerjaan tercatat'];
        showModal(history, date);
      }
    });

    calendar.render();

    // Klik di luar modal menutup popup
    document.addEventListener('click', function (event) {
      const isClickInside = modal.contains(event.target);
      if (!isClickInside && modal.style.display === 'block') {
        closeModal();
      }
    });
  }

  function showModal(historyList, date) {
    const modal = document.getElementById('historyModal');
    const content = document.getElementById('historyContent');
    content.innerHTML = `<strong>${date}</strong><ul>` + historyList.map(item => `<li>${item}</li>`).join('') + '</ul>';
    modal.style.display = 'block';
  }

  function closeModal() {
    document.getElementById('historyModal').style.display = 'none';
  }

  // Load data JSON saat halaman siap
  document.addEventListener('DOMContentLoaded', loadPekerjaanData);
</script>

</body>
</html>
